<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Botanical Garden â€” 3D Viewer (Fixed Imports)</title>
  <style>
    html,body{height:100%;margin:0;background:#000;color:#fff;font-family:system-ui,Arial}
    #app{display:flex;flex-direction:column;height:100vh}
    #viewer{flex:1;min-height:320px;position:relative}
    canvas{width:100%;height:100%;display:block}
    #list{display:flex;gap:10px;padding:10px;overflow-x:auto;background:#060606}
    .item{flex:0 0 auto;padding:8px 12px;border-radius:10px;background:#0d0d0d;border:1px solid #222;color:#fff}
    .emoji{font-size:26px;display:block;text-align:center}
    @media(min-width:900px){#app{flex-direction:row}#list{flex-direction:column;min-width:220px;height:100vh}}
  </style>
</head>
<body>
  <div id="app">
    <div id="viewer"><canvas id="c" aria-label="3D botanical viewer"></canvas></div>
    <div id="list"></div>
  </div>  <!-- Direct module imports (no bare specifiers) -->  <script type="module">
  import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
  import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';

  // Data
  const FLOWERS = [
    {emoji:'ðŸŒ¹',name:'Rose',id:'rose'},
    {emoji:'ðŸŒ·',name:'Tulip',id:'tulip'},
    {emoji:'ðŸŒ»',name:'Sunflower',id:'sunflower'},
    {emoji:'ðŸª»',name:'Hyacinth',id:'hyacinth'},
    {emoji:'ðŸŒ±',name:'Seedling',id:'seedling'},
    {emoji:'ðŸŒ¾',name:'Grain',id:'grain'},
    {emoji:'ðŸ',name:'Maple',id:'maple'},
    {emoji:'â˜˜ï¸',name:'Shamrock',id:'shamrock'},
    {emoji:'ðŸ„',name:'Mushroom',id:'mushroom'},
    {emoji:'ðŸŒ¿',name:'Artemisia',id:'wormwood'}
  ];

  // Build UI
  const list = document.getElementById('list');
  FLOWERS.forEach(f=>{
    const b = document.createElement('button');
    b.className = 'item'; b.type = 'button';
    b.innerHTML = `<span class="emoji">${f.emoji}</span><div>${f.name}</div>`;
    b.addEventListener('click', ()=> focusFlower(f.id));
    list.appendChild(b);
  });

  // Three.js variables
  const canvas = document.getElementById('c');
  let renderer, scene, camera, controls;
  let sprites = [];

  function safeNumber(n, fallback){ return Number.isFinite(n) ? n : fallback; }

  function init(){
    try{
      renderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:true});
      renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));

      // Compute viewer area height (mobile-first: 70% height)
      const vw = window.innerWidth; const vh = window.innerHeight;
      const viewerHeight = (vw < 900) ? Math.round(vh * 0.70) : vh;
      renderer.setSize(vw, viewerHeight, false);

      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(45, safeNumber(vw/viewerHeight, 1.6), 0.1, 200);
      camera.position.set(0, 1.2, 3);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true; controls.dampingFactor = 0.08;
      controls.minDistance = 0.8; controls.maxDistance = 20;

      const hemi = new THREE.HemisphereLight(0xffffff, 0x222222, 0.9); scene.add(hemi);
      const dir = new THREE.DirectionalLight(0xffffff, 0.5); dir.position.set(3,5,2); scene.add(dir);

      const ground = new THREE.Mesh(new THREE.PlaneGeometry(30,30), new THREE.MeshStandardMaterial({color:0x080808, roughness:1}));
      ground.rotation.x = -Math.PI/2; ground.position.y = -0.6; scene.add(ground);

      placeSprites();
      animate();
    }catch(err){
      console.error('Init error', err);
      showOverlayError(err);
    }
  }

  function showOverlayError(err){
    const overlay = document.createElement('div');
    overlay.style.position='absolute'; overlay.style.left='12px'; overlay.style.top='12px'; overlay.style.padding='10px'; overlay.style.background='rgba(0,0,0,0.6)'; overlay.style.border='1px solid #550000'; overlay.style.borderRadius='8px'; overlay.style.zIndex=9999;
    overlay.innerHTML = `<strong>Viewer error</strong><div style="max-width:320px;font-size:13px;margin-top:6px;color:#f3b1b1">${String(err).slice(0,200)}</div>`;
    document.getElementById('viewer').appendChild(overlay);
  }

  function createEmojiTexture(emoji){
    const size = 512;
    const cvs = document.createElement('canvas'); cvs.width = cvs.height = size;
    const ctx = cvs.getContext('2d');
    ctx.clearRect(0,0,size,size);
    ctx.fillStyle = 'white';
    ctx.font = '300px serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillText(emoji, size/2, size/2);
    const tex = new THREE.CanvasTexture(cvs); tex.needsUpdate = true; return tex;
  }

  function placeSprites(){
    const R = 2.0; sprites = [];
    FLOWERS.forEach((f,i)=>{
      const a = i / FLOWERS.length * Math.PI * 2;
      const tex = createEmojiTexture(f.emoji);
      const mat = new THREE.SpriteMaterial({map:tex, transparent:true});
      const s = new THREE.Sprite(mat);
      s.position.set(Math.cos(a)*R, 0.9 + Math.sin(a*2)*0.02, Math.sin(a)*R);
      s.scale.set(1.0,1.0,1.0);
      s.userData = f;
      scene.add(s); sprites.push(s);
    });
  }

  function focusFlower(id){
    const s = sprites.find(x=>x.userData.id===id); if(!s) return;
    controls.target.copy(s.position);
    camera.position.set(s.position.x*1.6, s.position.y + 0.6, s.position.z*1.6);
  }

  function animate(){
    requestAnimationFrame(animate);
    if(controls) controls.update();
    if(renderer && scene && camera) renderer.render(scene, camera);
  }

  window.addEventListener('resize', ()=>{
    if(!renderer || !camera) return;
    const vw = window.innerWidth; const vh = window.innerHeight;
    const viewerHeight = (vw < 900) ? Math.round(vh * 0.70) : vh;
    renderer.setSize(vw, viewerHeight, false);
    camera.aspect = safeNumber(vw/viewerHeight, camera.aspect);
    camera.updateProjectionMatrix();
  });

  // Init the viewer
  init();
  </script></body>
</html>
